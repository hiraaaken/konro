# Konro - ポジティブ励ましチャットボット 要件定義

## 概要

**アプリ名**: Konro（コンロ）

ユーザーの相談や悩み、ネガティブな感情に対して、全てポジティブに言い換え、全力で励ましてくれるチャットボットの開発

## ユーザーフロー・操作動線

### 0. 初回ユーザー情報入力（オプション機能）

- **初回起動時のみ表示**: ローカルストレージに情報がない場合
- **入力項目**:
  - 年齢（年代選択）: 10 代/20 代/30 代/40 代/50 代/60 代以上
  - 性別: 男性/女性/その他/回答しない
  - 職業（選択式）: 学生/会社員/公務員/自営業/専業主婦(夫)/その他
- **保存方法**: ローカルストレージに保存
- **スキップ機能**: 「後で設定」ボタンで入力をスキップ可能
- **編集機能**: 設定画面からいつでも変更可能

### 1. 火力選択画面

- アプリ起動後、最初に励ましレベル（火力）を選択
- 弱火・中火・強火の 3 つから選択
- 各火力の特徴を簡潔に説明表示

### 2. チャット画面への遷移

- 火力選択後、自動的にチャット画面に遷移
- 選択した火力に応じたチャットボットのキャラクター設定が適用
- **火力変更不可**: チャット中の火力変更は不可、ルーム退出が必要

### 4. 退出フロー

- **コンロ点火/消火 UI**: 点火（継続）・消火（退出）を選択可能
- **退出確認**: 消火選択時に「チャットを終了しますか？」の確認ダイアログ
- **お疲れさまメッセージ**: 終了確定後にお疲れさまメッセージを表示
- **火力選択画面へ戻る**: メッセージ後、自動的に火力選択画面に遷移

### 3. 会話の開始

- **チャットボット側から積極的に会話をスタート**
- 落ち込んでいる前提での声かけ
- 火力別の初回メッセージ例：
  - **弱火**: 「お疲れさま。今日はどうしたの？何か辛いことでもあった？」
  - **中火**: 「やあ！今日はどんなことがあったんだい？話してみて！」
  - **強火**: 「どうした！何があった！全部話せ！」

## 主要機能

### 1. ネガティブ感情の検知・分析

- ユーザーの投稿からネガティブな感情や悩みを自動検知
- 落ち込み、不安、怒り、悲しみなどの感情状態を理解

### 2. ポジティブ変換機能

- ネガティブな表現を自動的にポジティブな表現に言い換え
- 視点の転換を促すような提案
- 前向きな解釈や捉え方の提示

### 3. 励まし・サポート機能（オリジナル機能）

- **励ましレベル選択機能**: ユーザーが 3 段階から選択可能

  **弱火モード（優しい励まし）**

  - 穏やかで優しいトーン
  - ユーザーを決して否定せず、全面的に受け入れ
  - 深い共感と理解を示す
  - 寄り添うような温かいメッセージ

  **中火モード（元気な励まし）**

  - 元気で明るいトーン
  - 積極的なアドバイスと具体的な提案
  - 前向きな行動を促す
  - バランスの取れた共感とアクション指向

  **強火モード（熱血励まし）**

  - 激しく情熱的なトーン
  - 高圧的で強烈な励まし（パワハラ風）
  - 「弱音を吐くな」「やれば出来る」的な叱咤激励

### 4. インタラクティブアニメーション機能

- **ネガティブワード検知**: ユーザーの投稿内容をリアルタイム分析
- **炎燃焼アニメーション**: ネガティブワードを炎で燃やし焦がす演出
- **視覚的ポジティブ変換**: 文字が燃えて新しいポジティブな表現に変化

### 5. インタラクティブ UI 要素

- **コンロ点火/消火スイッチ**: 視覚的に分かりやすいトグル UI
- **確認ダイアログ**: 退出時の意思確認（誤操作防止）
- **お疲れさまメッセージ画面**: 励ましの言葉で終了
- **スムーズな画面遷移**: ユーザビリティを重視した動線

## 対象ユーザー

- **年齢層**: 全年齢対象
- **利用シーン**: 悩み相談、感情的サポートが必要な時
- **ユーザーの悩み例**:
  - 人間関係の問題
  - 仕事・学業のストレス
  - 将来への不安
  - 自己肯定感の低下
  - 日常的な落ち込み

## 開発方針・実装規約

### 開発手法

- **TDD (Test-Driven Development) 採用**
- **Red-Green-Refactor サイクル**:
  1. **Red**: 失敗するテストを最初に書く
  2. **Green**: テストを通すための最小限のコードを書く
  3. **Refactor**: コードをリファクタリング（テストは通ったまま）

### テスト戦略

#### フロントエンド (Nuxt.js)

- **テストフレームワーク**: Vitest + Vue Test Utils
- **テスト対象**:
  - コンポーネントの振る舞い
  - ユーザーインタラクション
  - 状態管理 (Pinia)
  - API 通信モック
- **テストレベル**: Unit Test, Integration Test

#### バックエンド (Lambda/TypeScript)

- **テストフレームワーク**: Jest + AWS SDK Mock
- **テスト対象**:
  - Lambda 関数のロジック
  - DynamoDB 操作
  - Bedrock API 連携
  - エラーハンドリング
- **テストレベル**: Unit Test, Integration Test

#### E2E テスト

- **フレームワーク**: Playwright
- **テスト対象**:
  - ユーザーフロー全体
  - 火力選択〜チャット〜退出の一連の流れ
  - アニメーション動作確認

### アーキテクチャパターン

- **オニオンアーキテクチャ採用**
- **依存関係の方向**: 外側 → 内側（ドメイン層が最も内側）
- **レイヤー構成**:
  1. **Domain Layer（ドメイン層）**: エンティティ、値オブジェクト、ドメインサービス
  2. **Application Layer（アプリケーション層）**: ユースケース、アプリケーションサービス
  3. **Infrastructure Layer（インフラ層）**: DB、外部 API、フレームワーク依存
  4. **Presentation Layer（プレゼンテーション層）**: Controller、UI

### ディレクトリ構造

#### バックエンド (Lambda/TypeScript)

```
src/
├── domain/                 # ドメイン層（依存なし）
│   ├── entities/           # エンティティ
│   │   ├── user.ts
│   │   ├── chat-session.ts
│   │   └── encouragement.ts
│   ├── value-objects/      # 値オブジェクト
│   │   ├── fire-level.ts
│   │   ├── user-info.ts
│   │   └── message.ts
│   ├── repositories/       # リポジトリインターface
│   │   ├── chat-repository.ts
│   │   └── user-repository.ts
│   └── services/           # ドメインサービス
│       └── encouragement-service.ts
├── application/            # アプリケーション層
│   ├── use-cases/          # ユースケース
│   │   ├── start-chat.ts
│   │   ├── send-message.ts
│   │   └── end-chat.ts
│   ├── services/           # アプリケーションサービス
│   │   └── bedrock-service.ts
│   └── interfaces/         # インターフェース定義
├── infrastructure/         # インフラ層
│   ├── repositories/       # リポジトリ実装
│   │   ├── dynamodb-chat-repository.ts
│   │   └── local-user-repository.ts
│   ├── external/           # 外部サービス
│   │   └── bedrock-client.ts
│   └── config/             # 設定
├── presentation/           # プレゼンテーション層
│   ├── handlers/           # Lambda handlers
│   │   ├── chat-handler.ts
│   │   └── user-handler.ts
│   └── dto/                # Data Transfer Object
└── shared/                 # 共通
    ├── errors/             # エラー定義
    └── utils/              # ユーティリティ
```

#### フロントエンド (Nuxt.js)

```
├── components/             # UIコンポーネント
│   ├── organisms/          # 複合コンポーネント
│   │   ├── FireLevelSelector.vue
│   │   ├── ChatInterface.vue
│   │   └── UserInfoForm.vue
│   ├── molecules/          # 中間コンポーネント
│   │   ├── ChatBubble.vue
│   │   ├── FireAnimation.vue
│   │   └── ExitButton.vue
│   └── atoms/              # 基本コンポーネント
│       ├── Button.vue
│       └── Input.vue
├── composables/            # アプリケーション層
│   ├── useChat.ts          # チャット用ユースケース
│   ├── useUserInfo.ts      # ユーザー情報管理
│   └── useFireLevel.ts     # 火力管理
├── services/               # インフラ層
│   ├── api/                # API通信
│   │   └── chat-api.ts
│   ├── storage/            # ローカルストレージ
│   │   └── user-storage.ts
│   └── animation/          # アニメーション
│       └── fire-animation.ts
├── types/                  # 型定義
│   ├── domain/             # ドメイン型
│   └── api/                # API型
└── utils/                  # ユーティリティ
```

- **テストファースト**: 機能実装前に必ずテストを書く
- **仕様確認プロセス**:
  1. **Issue 作成**: 小さな機能単位で GitHub Issue 作成
  2. **テスト仕様書作成**: 機能の動作を Todo リスト形式で整理
  3. **仕様確認**: テスト仕様書の内容を確認・承認
  4. **ブランチ作成**: Issue 番号に紐づく feature ブランチ作成
  5. **TDD 実装**: テスト仕様書に沿ってテストコード作成
  6. **実装**: Red-Green-Refactor サイクルで実装
  7. **PR 作成**: レビュー・マージ・Issue クローズ
- **テストカバレッジ**: 80%以上を目標
- **命名規則**: テスト名は「should*〜\_when*〜」形式
- **モックの活用**: 外部依存(AWS SDK、API)は積極的にモック化

### テスト仕様書フォーマット

各機能実装時に以下の Todo リスト形式で仕様を整理：

```markdown
## [機能名] テスト仕様書

### 基本動作

- [ ] 正常系: [期待する動作]
- [ ] 異常系: [エラーケース]
- [ ] 境界値: [境界条件での動作]

### UI/UX

- [ ] 表示: [画面表示の確認]
- [ ] 操作: [ユーザー操作の確認]
- [ ] レスポンシブ: [デバイス対応]

### API/データ

- [ ] リクエスト: [API 呼び出し確認]
- [ ] レスポンス: [レスポンス処理確認]
- [ ] エラーハンドリング: [エラー時の処理]

### パフォーマンス

- [ ] 応答時間: [レスポンス時間確認]
- [ ] リソース使用量: [メモリ・CPU 使用量]
```

## アーキテクチャ・技術仕様

### クラウド基盤

- **AWS**をメインプラットフォームとして使用

### 詳細アーキテクチャ構成

#### フロントエンド

- **ホスティング**: Amazon S3 (静的ウェブサイトホスティング)
- **CDN**: Amazon CloudFront (グローバル配信・キャッシュ)
- **フレームワーク**: Nuxt.js (Vue 3) + Tailwind CSS
- **ビルド成果物**: 静的サイト生成 (SSG)

#### バックエンド

- **API**: Amazon API Gateway (REST API)
- **コンピュート**: AWS Lambda (TypeScript 実行環境)
- **AI/ML**: Amazon Bedrock (自然言語処理・応答生成)
- **データベース**: Amazon DynamoDB (セッション管理)

#### インフラ管理・デプロイ

- **IaC**: AWS CloudFormation (Infrastructure as Code)
- **デプロイ戦略**:
  - フロントエンド: S3 バケットへの静的ファイルアップロード
  - バックエンド: CloudFormation スタックデプロイ
- **環境管理**: dev/staging/prod 環境の分離

#### セキュリティ・設定

- **CORS**: API Gateway でのクロスオリジン設定
- **HTTPS**: CloudFront での SSL/TLS 終端
- **API 認証**: API Key or IAM 認証（検討中）
- **レート制限**: API Gateway でのスロットリング設定

### データ管理方針

- **チャット履歴保存なし**: 会話終了時にデータ削除
- **ユーザー基本情報**: ローカルストレージに保存（端末内のみ）
- セッション管理のみ DynamoDB で一時保存
- プライバシー重視の設計（サーバーに個人情報送信なし）

### 技術スタック

- **フロントエンド**:
  - Nuxt.js (Vue 3) + Tailwind CSS
  - Amazon S3 + CloudFront
- **バックエンド**:
  - TypeScript on AWS Lambda
  - Amazon API Gateway
- **AI/ML**: Amazon Bedrock
- **データベース**: Amazon DynamoDB
- **インフラ**: AWS CloudFormation
- **アニメーション**: CSS Animations + Vue Transition API

## 技術要件

### 基本機能

- リアルタイムチャット機能
- Amazon Bedrock による自然言語処理・感情分析
- AI による応答生成（Bedrock 活用）
- **励ましレベル切り替え機能**（弱火・中火・強火）
- **ユーザー情報管理**: ローカルストレージによる基本情報保存
- **パーソナライズ機能**: ユーザー情報に基づく励まし内容の調整
- セッション管理（一時的）
- **ネガティブワード検知・アニメーション機能**
- **チャット履歴非保存**（プライバシー配慮）
- 多言語対応（日本語メイン）

### 非機能要件

- 24 時間 365 日利用可能
- レスポンス時間: 3 秒以内
- プライバシー保護
- 会話データの適切な管理

## UI/UX 要件

### デザイン指針

- 温かみのある親しみやすいデザイン
- 年齢問わず使いやすいインターフェース
- 明るく前向きな色調
- 直感的な操作性

### 会話体験

- 自然で人間らしい対話
- **選択した励ましレベルに応じた口調・トーンの変化**
- 適度な絵文字や感情表現（レベルに応じて調整）
- ユーザーに寄り添う共感的なトーン（弱火・中火）
- 熱血指導的なトーン（強火）
- 各モードの特性を活かした個性的な応答

## セキュリティ・プライバシー

- 個人情報の適切な保護
- 会話内容の機密性確保
- 未成年者への配慮
- 危機的状況の検知と適切な対応

## 追加検討事項

- 専門カウンセラーへの案内機能
- 緊急時のサポート体制
- 継続的な学習・改善機能
- ユーザーフィードバック収集機能

## 成功指標

- ユーザー満足度
- 継続利用率
- ポジティブ感情への変化度
- 利用頻度・滞在時間
